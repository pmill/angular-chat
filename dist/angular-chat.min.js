!function(){"use strict";angular.module("angular-chat",[])}(),function(){"use strict";function n(n){function e(e,t){return m=e,f=t,n.connect().then(function(){return n.subscribe(m)})}function t(e){return n.send(m,"message.received",e)}function o(){return n.send(m,"user.connected",f)}function r(){return console.log("sendUserDetails"),n.send(m,"user.details",f)}function u(e){return n.on(m,"room.created",e)}function c(e){return n.on(m,"message.received",e)}function a(e){return n.on(m,"user.connected",e).then(function(){console.log("onUserJoined"),r(f)})}function i(e){return n.on(m,"user.details",e)}function s(t){if(t===f.id)throw"Can't start a chat with yourself!";var o=l([f.id,t]);e(o).then(function(){return n.send(o,"chat.created",o)})}function l(n){return n=n.sort(),"private-chat-room-"+d(n.join("|"))}function d(n){return n.split("").reduce(function(n,e){return n=(n<<5)-n+e.charCodeAt(0),n&n},0)}var f=null,m=null;return{connectToRoom:e,onRoomCreated:u,onMessageReceived:c,onUserDetailsReceived:i,onUserJoined:a,sendMessage:t,sendUserConnected:o,sendUserDetails:r,startChatWithUser:s}}angular.module("angular-chat").factory("ChatRoomService",n),n.$inject=["SocketService"]}(),function(){"use strict";function n(n,e){function t(){return a=new ScaleDrone(e.channelId),n(function(n,e){a.on("open",function(t){return console.log("open"),t?e(t):n()})})}function o(e,t,o){return n(function(n,r){c(e).on("data",function(e){return e.event==t?(o(e.payload),n(e.payload)):void 0})})}function r(n,e,t){console.log("sending message",n,e,t),a.publish({room:n,message:{event:e,payload:t}})}function u(e){return n(function(n,t){i[e]=a.subscribe(e),i[e].on("open",function(e){return e?t(e):n()})})}function c(n){return i[n]}var a,i={};return{connect:t,on:o,room:c,send:r,subscribe:u}}angular.module("angular-chat").factory("SocketService",n),n.$inject=["$q","socketConfig"]}(),function(){"use strict";function n(){return{restrict:"E",scope:{user:"="},templateUrl:"lobby.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0}}function e(n,e){function t(){e.connectToRoom(u.data.lobbyName,u.user).then(function(){e.sendUserConnected(),e.onUserJoined(o),e.onUserDetailsReceived(o),e.onRoomCreated(r)})}function o(e){e.id!==u.data.user.id&&(u.data.users[e.id]=e,n.$apply())}function r(e){u.data.rooms.push(e),n.$apply()}var u=this;u.data={lobbyName:"public-chat-users",users:{},rooms:[],user:u.user},t()}angular.module("angular-chat").directive("pmChatLobby",n),e.$inject=["$scope","ChatRoomService"]}(),function(){angular.module("angular-chat").run(["$templateCache",function(n){n.put("lobby.html",'<div>\n    <h1>Lobby {{vm.data.user}}</h1>\n\n    <ul>\n        <li ng-repeat="user in vm.data.users">\n            {{user}}\n        </li>\n    </ul>\n</div>')}])}();
//# sourceMappingURL=angular-chat.min.js.map
