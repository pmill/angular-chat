!function(){"use strict";angular.module("angular-chat",[])}(),function(){"use strict";function n(){return{restrict:"E",scope:{user:"="},templateUrl:"lobby.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0}}function e(n,e){function t(){var n=e.fetchRoom(a.data.lobbyName,a.user);n.connect(a.data.lobbyName,a.user).then(function(){n.sendUserConnected(),n.onUserConnected(r),n.onUserDisconnected(s),n.onUserDetailsReceived(r),n.onRoomCreated(c)})}function o(n){null!==a.data.selectedRoom&&e.disconnect()}function s(n){delete a.data.users[n.id]}function r(e){e.id!==a.data.user.id&&(a.data.users[e.id]=e,a.state.loading=!1,n.$apply())}function c(e){a.data.rooms.push(e),n.$apply()}var a=this;a.data={lobbyName:"public-chat-users",users:{},rooms:[],user:a.user,selectedRoom:null},a.state={loading:!0},a.chatWithUser=o,t()}angular.module("angular-chat").directive("pmChatLobby",n),e.$inject=["$scope","ChatRoomService"]}(),function(){"use strict";function n(n,e){function t(n,e){return new g(n,e)}function o(){var t=this;return n.onbeforeunload=function(){e.send(this.roomName,"user.disconnected",this.currentUser)},e.connect().then(function(){return e.subscribe(t.roomName)})}function s(){e.disconnect(this.roomName,this.currentUser)}function r(n){return e.send(this.roomName,"message.received",n)}function c(){return e.send(this.roomName,"user.connected",this.currentUser)}function a(){return e.send(this.roomName,"user.details",this.currentUser)}function i(n){return e.on(this.roomName,"room.created",this.callback)}function u(n){return e.on(this.roomName,"message.received",this.callback)}function l(n){function t(e){o.sendUserDetails(o.currentUser),n(e)}var o=this;return e.on(this.roomName,"user.connected",t)}function d(n){return e.on(this.roomName,"user.disconnected",n)}function m(n){return e.on(this.roomName,"user.details",n)}function f(n){if(n===this.currentUser.id)throw"Can't start a chat with yourself!";var t=h([this.currentUser.id,n]);connectToRoom(t).then(function(){return e.send(t,"room.created",t)})}function h(n){return n=n.sort(),"private-chat-room-"+p(n.join("|"))}function p(n){return n.split("").reduce(function(n,e){return n=(n<<5)-n+e.charCodeAt(0),n&n},0)}var g=function(n,e){this.roomName=n,this.currentUser=e};return g.prototype.connect=o,g.prototype.disconnect=s,g.prototype.onRoomCreated=i,g.prototype.onMessageReceived=u,g.prototype.onUserDetailsReceived=m,g.prototype.onUserConnected=l,g.prototype.onUserDisconnected=d,g.prototype.sendMessage=r,g.prototype.sendUserConnected=c,g.prototype.sendUserDetails=a,g.prototype.startChatWithUser=f,{fetchRoom:t,startChatWithUser:f}}angular.module("angular-chat").factory("ChatRoomService",n),n.$inject=["$window","SocketService"]}(),function(){"use strict";function n(n,e){function t(){return u=new ScaleDrone(e.channelId),n(function(n,e){u.on("open",function(t){return t?e(t):n()})})}function o(n,e){c(n,"user.disconnected",e),u.close()}function s(){return n(function(n,e){u.on("close",function(){console.log("close()"),n()})})}function r(n,e,t){console.log("subscribing to event",n,e),i(n).on("data",function(o){o.event==e&&(console.log("processing message",n,e,o),t(o.payload))})}function c(n,e,t){console.log("sending message",n,e,t),u.publish({room:n,message:{event:e,payload:t}})}function a(e){return n(function(n,t){l[e]=u.subscribe(e),l[e].on("open",function(e){return e?t(e):n()})})}function i(n){return l[n]}var u,l={};return{connect:t,disconnect:o,on:r,onDisconnect:s,room:i,send:c,subscribe:a}}angular.module("angular-chat").factory("SocketService",n),n.$inject=["$q","socketConfig"]}(),function(){angular.module("angular-chat").run(["$templateCache",function(n){n.put("lobby.html",'<div class="row">\n    <div class="col-md-4 col-xs-12">\n        <div class="panel panel-default">\n            <div class="panel-heading">\n                <h3 class="panel-title"><span class="fa fa-users"></span> Lobby</h3>\n            </div>\n\n            <div class="list-group">\n                <button class="list-group-item"\n                        ng-repeat="u in vm.data.users"\n                        ng-if="!vm.state.loading"\n                        ng-click="vm.chatWithUser(u)">\n                    <h4 class="list-group-item-heading">\n                        <span class="fa fa-user"></span> {{u.name}}\n                    </h4>\n                </button>\n                <span class="list-group-item" ng-if="vm.state.loading">\n                    <h4 class="list-group-item-heading">\n                        <i class="fa fa-cog fa-spin fa-fw margin-bottom"></i>\n                        loading...\n                    </h4>\n                </span>\n            </div>\n        </div>\n    </div>\n\n    <div class="col-md-8">\n        <div class="panel panel-default" ng-if="vm.data.selectedRoom !== null">\n            <div class="panel-heading">\n                <h3 class="panel-title"><span class="fa fa-comment-o"></span> Room</h3>\n            </div>\n        </div>\n    </div>\n</div>\n')}])}();
//# sourceMappingURL=angular-chat.min.js.map
