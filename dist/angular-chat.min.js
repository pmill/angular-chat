!function(){"use strict";angular.module("angular-chat",[])}(),function(){"use strict";function n(){return{restrict:"E",scope:{user:"="},templateUrl:"lobby.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0}}function e(n,e){function t(){e.connectToRoom(c.data.lobbyName,c.user).then(function(){e.sendUserConnected(),e.onUserConnected(s),e.onUserDisconnected(o),e.onUserDetailsReceived(s),e.onRoomCreated(a)})}function o(n){delete c.data.users[n.id]}function s(e){e.id!==c.data.user.id&&(c.data.users[e.id]=e,c.state.loading=!1,n.$apply())}function a(e){c.data.rooms.push(e),n.$apply()}var c=this;c.data={lobbyName:"public-chat-users",users:{},rooms:[],user:c.user},c.state={loading:!0},t()}angular.module("angular-chat").directive("pmChatLobby",n),e.$inject=["$scope","ChatRoomService"]}(),function(){"use strict";function n(n,e){function t(t,o){return p=t,g=o,n.onbeforeunload=function(){e.send(p,"user.disconnected",g)},e.connect().then(function(){return e.subscribe(p)})}function o(n){return e.send(p,"message.received",n)}function s(){return e.send(p,"user.connected",g)}function a(){return e.send(p,"user.details",g)}function c(n){return e.on(p,"room.created",n)}function r(n){return e.on(p,"message.received",n)}function i(n){function t(e){a(g),n(e)}return e.on(p,"user.connected",t)}function u(n){return e.on(p,"user.disconnected",n)}function l(n){return e.on(p,"user.details",n)}function d(n){if(n===g.id)throw"Can't start a chat with yourself!";var o=f([g.id,n]);t(o).then(function(){return e.send(o,"room.created",o)})}function f(n){return n=n.sort(),"private-chat-room-"+m(n.join("|"))}function m(n){return n.split("").reduce(function(n,e){return n=(n<<5)-n+e.charCodeAt(0),n&n},0)}var g=null,p=null;return{connectToRoom:t,onRoomCreated:c,onMessageReceived:r,onUserDetailsReceived:l,onUserConnected:i,onUserDisconnected:u,sendMessage:o,sendUserConnected:s,sendUserDetails:a,startChatWithUser:d}}angular.module("angular-chat").factory("ChatRoomService",n),n.$inject=["$window","SocketService"]}(),function(){"use strict";function n(n,e){function t(){return i=new ScaleDrone(e.channelId),n(function(n,e){i.on("open",function(t){return t?e(t):n()})})}function o(){return n(function(n,e){i.on("close",function(){console.log("close()"),n()})})}function s(n,e,t){console.log("subscribing to event",n,e),r(n).on("data",function(o){o.event==e&&(console.log("processing message",n,e,o),t(o.payload))})}function a(n,e,t){console.log("sending message",n,e,t),i.publish({room:n,message:{event:e,payload:t}})}function c(e){return n(function(n,t){u[e]=i.subscribe(e),u[e].on("open",function(e){return e?t(e):n()})})}function r(n){return u[n]}var i,u={};return{connect:t,on:s,onDisconnect:o,room:r,send:a,subscribe:c}}angular.module("angular-chat").factory("SocketService",n),n.$inject=["$q","socketConfig"]}(),function(){angular.module("angular-chat").run(["$templateCache",function(n){n.put("lobby.html",'<div class="row">\n    <div class="col-md-4 col-xs-12">\n        <div class="panel panel-default">\n            <div class="panel-heading">\n                <h3 class="panel-title"><span class="fa fa-users"></span> Lobby</h3>\n            </div>\n\n            <div class="list-group">\n                <button class="list-group-item" ng-repeat="u in vm.data.users" ng-if="!vm.state.loading">\n                    <h4 class="list-group-item-heading">\n                        <span class="fa fa-user"></span> {{u.name}}\n                    </h4>\n                </button>\n                <span class="list-group-item" ng-if="vm.state.loading">\n                    <h4 class="list-group-item-heading">\n                        <i class="fa fa-cog fa-spin fa-fw margin-bottom"></i>\n                        loading...\n                    </h4>\n                </span>\n            </div>\n        </div>\n    </div>\n\n    <div class="col-md-8">\n        <div class="panel panel-default">\n            <div class="panel-heading">\n                <h3 class="panel-title"><span class="fa fa-comment-o"></span> Room</h3>\n            </div>\n        </div>\n    </div>\n</div>\n')}])}();
//# sourceMappingURL=angular-chat.min.js.map
